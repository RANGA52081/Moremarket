{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>More Market</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body class="bg-light">

<!-- ðŸ” HEADER -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container">

        <!-- Logo -->
        <a class="navbar-brand fw-bold text-primary" href="#">MoreMarket</a>

        <!-- Mobile Toggle -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Content -->
        <div class="collapse navbar-collapse" id="navbarContent">

            <!-- Search -->
            <form class="d-flex mx-lg-4 my-2 my-lg-0 flex-grow-1">
                <input class="form-control me-2" type="search" placeholder="Search scaffolding products">
                <button class="btn btn-primary">Search</button>
            </form>

            <!-- Right Icons -->
<div class="d-flex align-items-center gap-4">

    <!-- LOCATION -->
<div class="position-relative location-wrapper">

    <!-- Trigger -->
    <div class="d-flex align-items-center gap-2 location-trigger"
         onclick="toggleLocationDropdown()">

        <i class="bi bi-geo-alt fs-5 text-muted"></i>

        <div class="d-flex flex-column lh-sm">
            <span class="small text-secondary">Deliver to</span>
            <strong id="selected-location">
                {{ request.session.selected_location|default:"India (Any Area)" }}
            </strong>
        </div>
    </div>

    <!-- DROPDOWN -->
    <div id="locationDropdown" class="location-dropdown shadow-lg">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="fw-bold m-0">Choose your location</h6>
            <span class="close-btn" onclick="closeLocationDropdown()">âœ•</span>
        </div>

        <!-- SAVED ADDRESSES (If Logged In) -->
        {% if user.is_authenticated and user.addresses.all %}
        <div class="saved-address-section mb-3">
            <small class="text-muted">Your saved addresses</small>

            {% for address in user.addresses.all %}
            <div class="saved-address-card"
                 onclick="selectSavedAddress('{{ address.city }} {{ address.pincode }}')">

                <strong>{{ address.full_name }}</strong><br>
                <small>
                    {{ address.area }}, {{ address.city }},
                    {{ address.state }} - {{ address.pincode }}
                </small>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Sign In Prompt -->
        {% if not user.is_authenticated %}
        <a href="{% url 'login' %}"
        class="btn btn-warning w-100 mb-3 text-decoration-none">
        Sign in to see your addresses
        </a>
        {% endif %}

        <!-- Divider -->
        <div class="text-center text-muted small mb-2">
            or enter an Indian pincode
        </div>

        <!-- Spinner -->
        <div id="locationSpinner" class="text-center mb-2" style="display:none;">
            <div class="spinner-border spinner-border-sm text-primary"></div>
        </div>

        <!-- PINCODE -->
        <input type="text"
               id="manualPincode"
               class="form-control form-control-sm mb-2"
               placeholder="Enter 6-digit Pincode"
               maxlength="6"
               onblur="fetchFromPincode()">

        <!-- AREA -->
        <input type="text"
               id="manualArea"
               class="form-control form-control-sm mb-2"
               placeholder="Area / Street">

        <!-- CITY -->
        <input type="text"
               id="manualCity"
               class="form-control form-control-sm mb-2"
               placeholder="City">

        <!-- STATE -->
        <input type="text"
               id="manualState"
               class="form-control form-control-sm mb-3"
               placeholder="State">

        <button onclick="applyManualAddress()"
                class="btn btn-primary w-100">
            Save Location
        </button>

        <small id="locationError"
               class="text-danger mt-2 d-block"
               style="display:none;">
            Please enter valid details.
        </small>

        <small class="text-muted mt-2 d-block">
            Delivery options may vary by location.
        </small>

    </div>
</div>
                <!-- CART -->
<a href="{% url 'cart' %}" class="text-dark position-relative text-decoration-none">
    <i class="bi bi-cart3 fs-5"></i>

    {% if cart_count and cart_count > 0 %}
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ cart_count }}
    </span>
    {% endif %}
</a>


{% if user.is_authenticated %}

<!-- USER DROPDOWN -->
<div class="dropdown">

    <div class="d-flex align-items-center gap-2 dropdown-toggle"
         data-bs-toggle="dropdown"
         style="cursor:pointer;">

        <i class="bi bi-person-circle fs-5"></i>

        <div class="d-flex flex-column lh-sm">
            <small class="text-muted">Hello,</small>
            <strong>{{ user.username }}</strong>
        </div>

    </div>

    <ul class="dropdown-menu dropdown-menu-end shadow">

        <li>
            <a class="dropdown-item" href="#">
                My Profile
            </a>
        </li>

        <li>
            <a class="dropdown-item" href="#">
                My Orders
            </a>
        </li>

        <li>
            <a class="dropdown-item" href="#">
                My Addresses
            </a>
        </li>

        <li><hr class="dropdown-divider"></li>

        <li>
            <a class="dropdown-item text-danger"
               href="{% url 'logout' %}">
                Logout
            </a>
        </li>

    </ul>

</div>

{% else %}

<!-- SIGN IN -->
<a href="{% url 'login' %}"
   class="text-decoration-none text-dark d-flex align-items-center gap-1">

    <i class="bi bi-person fs-5"></i>
    <span class="d-none d-md-inline">Sign in</span>

</a>

<!-- CREATE ACCOUNT -->
<a href="{% url 'register' %}"
   class="btn btn-primary d-flex align-items-center gap-2">

    <i class="bi bi-person-plus"></i>
    <span class="d-none d-md-inline">Create account</span>

</a>

{% endif %}

            </div>
        </div>
    </div>
</nav>

<!-- ðŸ“‚ CATEGORY BAR -->
<div class="bg-white border-top border-bottom">
    <div class="container d-flex gap-4 py-2 overflow-auto small fw-medium">

        <span class="text-primary">â˜° All Categories</span>
        <span>MS Scaffolding</span>
        <span>Aluminium</span>
        <span>Boards</span>
        <span>Jacks</span>
        <span>Accessories</span>

    </div>
</div>

<!-- ðŸ§± PAGE CONTENT -->
<main>
    {% block content %}{% endblock %}
</main>
<style>
    .custom-footer {
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: #ffffff;
    padding: 60px 0 30px;
}

.footer-title {
    font-weight: 700;
    color: #ffffff;
}

.footer-text {
    color: #cbd5e1;
    font-size: 14px;
    line-height: 1.6;
}

.footer-subtitle {
    font-weight: 600;
    margin-bottom: 15px;
    color: #ffffff;
}

.footer-links {
    list-style: none;
    padding: 0;
}

.footer-links li {
    margin-bottom: 8px;
}

.footer-links a {
    text-decoration: none;
    color: #cbd5e1;
    transition: 0.3s ease;
}

.footer-links a:hover {
    color: #3b82f6;
    padding-left: 5px;
}

.footer-social a {
    color: #cbd5e1;
    font-size: 20px;
    margin-right: 15px;
    transition: 0.3s ease;
}

.footer-social a:hover {
    color: #3b82f6;
    transform: translateY(-3px);
}

.footer-divider {
    border-color: rgba(255,255,255,0.1);
    margin: 30px 0 20px;
}

.footer-bottom {
    text-align: center;
    font-size: 13px;
    color: #94a3b8;
}
</style>
<!-- ðŸ¦¶ FOOTER -->
<footer class="custom-footer">
    <div class="container">

        <div class="row g-4">

            <div class="col-md-4">
                <h5 class="footer-title">MoreMarket</h5>
                <p class="footer-text">
                    Your trusted scaffolding and construction marketplace.
                </p>
            </div>

            <div class="col-md-4">
                <h6 class="footer-subtitle">Quick Links</h6>
                <ul class="footer-links">
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms & Conditions</a></li>
                </ul>
            </div>

            <div class="col-md-4">
                <h6 class="footer-subtitle">Follow Us</h6>
                <div class="footer-social">
                    <a href="#"><i class="bi bi-facebook"></i></a>
                    <a href="#"><i class="bi bi-instagram"></i></a>
                    <a href="#"><i class="bi bi-linkedin"></i></a>
                </div>
            </div>

        </div>

        <hr class="footer-divider">

        <div class="footer-bottom">
            Â© 2026 MoreMarket. All rights reserved.
        </div>

    </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JS -->
<script src="{% static 'js/main.js' %}"></script>

</body>
</html>